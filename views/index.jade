doctype html
html(lang='en')
    head
        meta(charset='utf-8')
        meta(http-equiv='X-UA-Compatible', content='IE=edge')
        meta(name='viewport', content='width=device-width, initial-scale=1')
        meta(name='description', content='')
        meta(name='author', content='')
        title Twitter Streaming API
        // Bootstrap core CSS
        link(href='/bower_components/bootstrap/dist/css/bootstrap.min.css', rel='stylesheet')
    body
        .navbar.navbar-inverse.navbar-fixed-top(role='navigation')
            .container
                .navbar-header
                    button.navbar-toggle(type='button', data-toggle='collapse', data-target='.navbar-collapse')
                        span.sr-only Toggle navigation
                        span.icon-bar
                        span.icon-bar
                        span.icon-bar
                    a.navbar-brand(href='#') Twitter Streaming API
                .navbar-collapse.collapse
        .jumbotron
            .container
                h1 Nearby Tweets
                p
                    | Viewing the latest nearby tweets...
                p
        #tweets.container
            hr
        script(src="/bower_components/jquery/dist/jquery.min.js")
        script(src='/bower_components/bootstrap/dist/js/bootstrap.min.js')
        script(src='/bower_components/underscore/underscore.js')
        script(src='/bower_components/backbone/backbone.js')
        script(src="/socket.io/socket.io.js")
        script.
          var tweets = new Backbone.Collection;
          tweets.on('add', display);
          var socket = io.connect('http://localhost:3000');

          function setPosition(location){
            if (location && location.coords) {
              var locationArray = [
                +(+location.coords.longitude.toPrecision(5) - 0.005).toPrecision(5),
                +(+location.coords.latitude.toPrecision(5) - 0.005).toPrecision(5),
                +(+location.coords.longitude.toPrecision(5) + 0.005).toPrecision(5),
                +(+location.coords.latitude.toPrecision(5) + 0.00).toPrecision(5)
              ];
              socket.emit('location', locationArray);
            }
          }
          function getLocation() {
            if(navigator.geolocation) {
              navigator.geolocation.getCurrentPosition(setPosition);
            }
            else {
              alert("Geolocation is not supported by this browser.");
            }
          }
          getLocation();

          function display(tweet) {
            var tweetID = tweet.get('id_str');
            var screenName = tweet.get('user')['screen_name'];
            var tweetLocation = tweet.get('place')['full_name'];
            var tweetText = tweet.get('text');
            var profileImg = tweet.get('user')['profile_image_url'];
            if (tweetLocation) screenName = screenName + ' - ' + tweetLocation;
            $("#tweets").prepend(
              '<div class="row">' +
              '<div class="col-mid-12">' +
              '<h2><a target="_blank" href="https://twitter.com/' + screenName + '/status/' + tweetID + '">' +
              tweetText + '</a></h2>' +
              '<p>@' + screenName + '</p>' +
              '<img src="' + profileImg + '"></img>' +
              '</div>' +
              '</div>'
            );
          }

          socket.on('tweet', function(tweet) {
            tweets.add(tweet);
          });

